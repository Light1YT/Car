<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Yellow Car Game</title>
  <style>
    body { margin: 0; overflow: hidden; }
    canvas { display: block; background: #222; }
  </style>
  <script src="https://cdn.jsdelivr.net/npm/phaser@3.60.0/dist/phaser.js"></script>
</head>
<body>
<script>

class MainScene extends Phaser.Scene {
  constructor() {
    super('MainScene');
    this.gameOverFlag = false;
  }

  preload() {
    this.load.image('car', 'car.png');
    this.load.image('bonus', 'bonus.png');
    this.load.image('obstacle', 'obstacle.png');
  }

  create() {
    this.laneCount = 3;
    this.speed = 200;
    this.score = 0;
    this.nextSpeedUp = 0;
    this.lastObstacleSpawnTime = 0;
    this.gameOverFlag = false;

    const gameWidth = this.sys.game.config.width;
    this.laneWidth = gameWidth / this.laneCount;

    this.player = this.physics.add.sprite(this.laneWidth * 1.5, 500, 'car');
    this.player.setDisplaySize(100, 57);
    this.player.setCollideWorldBounds(true);
    this.player.lane = 1;

    this.obstacles = this.physics.add.group();
    this.bonuses = this.physics.add.group();

    this.physics.add.overlap(this.player, this.obstacles, () => this.handleGameOver(), null, this);
    this.physics.add.overlap(this.player, this.bonuses, (player, bonus) => {
      bonus.destroy();
      this.score += 50;
    }, null, this);

    this.scoreText = this.add.text(10, 10, 'Score: 0', { font: '20px Arial', fill: '#fff' });

    this.input.keyboard.on('keydown-LEFT', () => this.changeLane(-1));
    this.input.keyboard.on('keydown-RIGHT', () => this.changeLane(1));
  }

  update(time, delta) {
    if (this.gameOverFlag) return;

    if (time > this.nextSpeedUp) {
      this.speed += 25;
      this.nextSpeedUp = time + 5000;
    }

    this.score += delta * 0.01;
    this.scoreText.setText('Score: ' + Math.floor(this.score));

    if (time - this.lastObstacleSpawnTime > 800) {
      const lanes = Phaser.Utils.Array.Shuffle([0, 1, 2]);
      let placedObstacles = 0;

      for (let i = 0; i < lanes.length; i++) {
        const lane = lanes[i];
        if (placedObstacles < 2 && Phaser.Math.Between(0, 1000) < 300) {
          this.spawnObject('obstacle', lane);
          placedObstacles++;
        } else if (Phaser.Math.Between(0, 1000) < 100) {
          this.spawnObject('bonus', lane);
        }
      }
      this.lastObstacleSpawnTime = time;
    }

    this.obstacles.children.iterate(child => child.y += this.speed * delta / 1000);
    this.bonuses.children.iterate(child => child.y += this.speed * delta / 1000);
  }

  spawnObject(type, lane) {
    const x = lane * this.laneWidth + this.laneWidth / 2;
    const y = -60;
    const group = (type === 'bonus') ? this.bonuses : this.obstacles;
    const sprite = group.create(x, y, type);
    sprite.setImmovable(true);
  }

  changeLane(dir) {
    if (this.gameOverFlag) return;
    this.player.lane = Phaser.Math.Clamp(this.player.lane + dir, 0, this.laneCount - 1);
    this.player.x = this.player.lane * this.laneWidth + this.laneWidth / 2;
  }

  handleGameOver() {
    if (this.gameOverFlag) return;
    this.gameOverFlag = true;

    this.physics.pause();
    this.player.setTint(0xff0000);

    this.add.rectangle(180, 320, 240, 120, 0x000000, 0.85);
    this.add.text(100, 280, 'Ты набрал: ' + Math.floor(this.score) + ' очков', { font: '18px Arial', fill: '#fff' });
    const okButton = this.add.text(140, 320, 'OK', { font: '22px Arial', fill: '#00ff00', backgroundColor: '#000' })
      .setPadding(10)
      .setInteractive()
      .on('pointerdown', () => {
        this.scene.restart();
      });
  }
}

const config = {
  type: Phaser.AUTO,
  width: 360,
  height: 640,
  physics: { default: 'arcade' },
  scene: MainScene
};

new Phaser.Game(config);
</script>
</body>
</html>