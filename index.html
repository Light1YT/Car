<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Yellow Car Game</title>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Commissioner:wght@400;700&display=swap');
    
    body { 
      margin: 0; 
      overflow: hidden; 
      background: #222222;
      font-family: 'Commissioner', sans-serif;
    }
    canvas { 
      display: block; 
      background: transparent;
      box-shadow: 0 0 20px rgba(255, 238, 0, 0.3);
    }
  </style>
  <script src="https://cdn.jsdelivr.net/npm/phaser@3.60.0/dist/phaser.js"></script>
</head>
<body>

<script>
// –ì–ª–æ–±–∞–ª—å–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∑–≤—É–∫–æ–º
class SoundManager {
  static isMuted = false;
  static musicVolume = 1.0;
  static effectsVolume = 1.0;
  static currentSounds = {}; // –û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ —Ç–µ–∫—É—â–∏—Ö –∑–≤—É–∫–æ–≤
  
  static init() {
    this.isMuted = GameData.load('soundMuted', false);
    this.musicVolume = GameData.load('musicVolume', 1.0);
    this.effectsVolume = GameData.load('effectsVolume', 1.0);
  }
  
  static toggleMute() {
    this.isMuted = !this.isMuted;
    GameData.save('soundMuted', this.isMuted);
  }
  
  static setMusicVolume(volume) {
    this.musicVolume = Math.max(0, Math.min(1, volume));
    GameData.save('musicVolume', this.musicVolume);
  }
  
  static setEffectsVolume(volume) {
    this.effectsVolume = Math.max(0, Math.min(1, volume));
    GameData.save('effectsVolume', this.effectsVolume);
  }
  
  static getMuteState() {
    this.init();
    return this.isMuted;
  }
  
  static playSound(scene, soundKey, baseVolume = 1) {
    if (!this.isMuted && scene.sound) {
      // –î–ª—è –∑–≤—É–∫–∞ benz –Ω–µ –≤–æ—Å–ø—Ä–æ–∏–∑–≤–æ–¥–∏–º, –µ—Å–ª–∏ —É–∂–µ –∏–≥—Ä–∞–µ—Ç
      if (soundKey === 'benz' && this.currentSounds[soundKey] && this.currentSounds[soundKey].isPlaying) {
        return null; // –ù–µ –≤–æ—Å–ø—Ä–æ–∏–∑–≤–æ–¥–∏–º –Ω–æ–≤—ã–π –∑–≤—É–∫
      }
      
      // –î–ª—è –¥—Ä—É–≥–∏—Ö –∑–≤—É–∫–æ–≤ –æ—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –ø—Ä–µ–¥—ã–¥—É—â–∏–π –∑–≤—É–∫ —Ç–æ–≥–æ –∂–µ —Ç–∏–ø–∞ –µ—Å–ª–∏ –æ–Ω –∏–≥—Ä–∞–µ—Ç
      if (soundKey !== 'benz' && this.currentSounds[soundKey] && this.currentSounds[soundKey].isPlaying) {
        this.currentSounds[soundKey].stop();
      }
      
      const finalVolume = baseVolume * this.effectsVolume;
      const sound = scene.sound.add(soundKey, { volume: finalVolume });
      
      // –°–æ—Ö—Ä–∞–Ω—è–µ–º —Å—Å—ã–ª–∫—É –Ω–∞ –∑–≤—É–∫
      this.currentSounds[soundKey] = sound;
      
      // –£–¥–∞–ª—è–µ–º —Å—Å—ã–ª–∫—É –∫–æ–≥–¥–∞ –∑–≤—É–∫ –∑–∞–∫–æ–Ω—á–∏—Ç—Å—è
      sound.once('complete', () => {
        delete this.currentSounds[soundKey];
      });
      
      sound.play();
      return sound;
    }
    return null;
  }
  
  static playMusic(scene, musicKey, baseVolume = 1, loop = true) {
    if (!this.isMuted && scene.sound) {
      // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –Ω–µ –∏–≥—Ä–∞–µ—Ç –ª–∏ —É–∂–µ —ç—Ç–∞ –∂–µ –º—É–∑—ã–∫–∞
      if (scene.currentMusic && scene.currentMusic.key === musicKey && scene.currentMusic.isPlaying) {
        // –û–±–Ω–æ–≤–ª—è–µ–º –≥—Ä–æ–º–∫–æ—Å—Ç—å —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–π –º—É–∑—ã–∫–∏
        scene.currentMusic.setVolume(baseVolume * this.musicVolume);
        return scene.currentMusic;
      }
      
      // –û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –ª—é–±—É—é –ø—Ä–µ–¥—ã–¥—É—â—É—é –º—É–∑—ã–∫—É
      if (scene.currentMusic) {
        scene.currentMusic.stop();
      }
      
      // –ó–∞–ø—É—Å–∫–∞–µ–º –Ω–æ–≤—É—é –º—É–∑—ã–∫—É
      const finalVolume = baseVolume * this.musicVolume;
      scene.currentMusic = scene.sound.add(musicKey, { volume: finalVolume, loop: loop });
      scene.currentMusic.play();
      return scene.currentMusic;
    }
    return null;
  }
  
  static stopMusic(scene) {
    if (scene.currentMusic) {
      scene.currentMusic.stop();
      scene.currentMusic = null;
    }
  }
  
  static updateMuteState(scene) {
    if (this.isMuted) {
      if (scene.currentMusic) {
        scene.currentMusic.pause();
      }
    } else {
      if (scene.currentMusic && scene.currentMusic.isPaused) {
        scene.currentMusic.resume();
      }
    }
  }
  
  static updateMusicVolume(scene, baseVolume = 1) {
    if (scene.currentMusic && scene.currentMusic.isPlaying) {
      scene.currentMusic.setVolume(baseVolume * this.musicVolume);
    }
  }
}

// –°–∏—Å—Ç–µ–º–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö
class GameData {
  static save(key, value) {
    localStorage.setItem(key, JSON.stringify(value));
  }
  
  static load(key, defaultValue = null) {
    const data = localStorage.getItem(key);
    return data ? JSON.parse(data) : defaultValue;
  }
  
  static addDiamonds(amount) {
    const current = this.load('diamonds', 0);
    this.save('diamonds', current + amount);
  }
  
  static getDiamonds() {
    return this.load('diamonds', 1000); // –¢–µ—Å—Ç–æ–≤—ã–π –±–∞–ª–∞–Ω—Å 1000 –∞–ª–º–∞–∑–æ–≤
  }
  
  static spendDiamonds(amount) {
    const current = this.getDiamonds();
    if (current >= amount) {
      this.save('diamonds', current - amount);
      return true;
    }
    return false;
  }
  
  static saveScore(score) {
    const scores = this.load('scores', []);
    scores.push(Math.floor(score));
    scores.sort((a, b) => b - a);
    scores.splice(10); // –û—Å—Ç–∞–≤–ª—è–µ–º —Ç–æ–ª—å–∫–æ —Ç–æ–ø-10
    this.save('scores', scores);
  }
  
  static getTopScores() {
    return this.load('scores', []);
  }
  
  static canClaimDailyReward() {
    const lastClaim = this.load('lastDailyReward', 0);
    const now = Date.now();
    const oneDay = 24 * 60 * 60 * 1000; // 24 —á–∞—Å–∞ –≤ –º–∏–ª–ª–∏—Å–µ–∫—É–Ω–¥–∞—Ö
    return (now - lastClaim) >= oneDay;
  }
  
  static claimDailyReward() {
    if (this.canClaimDailyReward()) {
      this.addDiamonds(1);
      this.save('lastDailyReward', Date.now());
      return true;
    }
    return false;
  }
  
  static resetDiamonds() {
    // –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Ç–µ—Å—Ç–æ–≤—ã–π –±–∞–ª–∞–Ω—Å (–¥–ª—è —Ä–µ—à–µ–Ω–∏—è –ø—Ä–æ–±–ª–µ–º —Å –∫–µ—à–µ–º)
    this.save('diamonds', 1000);
  }
}

// –ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é
class MenuScene extends Phaser.Scene {
  constructor() {
    super('MenuScene');
  }

  preload() {
    // –ó–∞–≥—Ä—É–∂–∞–µ–º —Ñ–æ–Ω –º–µ–Ω—é –∏ –ø–µ—Ä—Å–æ–Ω–∞–∂–µ–π
    this.load.image('bgMenu', 'bgMenu.png');
    this.load.image('man1', 'man1.png');
    this.load.image('man2', 'man2.png');
    
    // –ó–∞–≥—Ä—É–∂–∞–µ–º —Å–ø—Ä–∞–π—Ç—ã –º–æ–Ω–µ—Ç –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –≤ –º–µ–Ω—é
    this.load.image('coin1', 'coin1.png');
    this.load.image('coin2', 'coin2.png');
    
    // –ó–∞–≥—Ä—É–∂–∞–µ–º –Ω–æ–≤—ã–µ —ç–ª–µ–º–µ–Ω—Ç—ã –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞
    this.load.image('logo', 'logo.png');
    this.load.image('gameR', 'gameR.png');
    this.load.image('game', 'game.png');
    this.load.image('shopR', 'shopR.png');
    this.load.image('shop', 'shop.png');
    this.load.image('actionR', 'actionR.png');
    this.load.image('action', 'action.png');
    this.load.image('leaderboardR', 'leaderboardR.png');
    this.load.image('leaderboard', 'leaderboard.png');
    
    // –ó–∞–≥—Ä—É–∂–∞–µ–º –∑–≤—É–∫–∏
    this.load.audio('MM', 'MM.mp3');
    this.load.audio('GM', 'GM.mp3');
    this.load.audio('smash', 'smash.mp3');
    this.load.audio('coin', 'coin.mp3');
    this.load.audio('benz', 'benz.mp3');
  }

  create() {
    const gameWidth = this.sys.game.config.width;
    const gameHeight = this.sys.game.config.height;

    // –§–æ–Ω –º–µ–Ω—é —Å —ç—Ñ—Ñ–µ–∫—Ç–æ–º –±–ª—é—Ä–∞
    const bgMenu = this.add.image(gameWidth / 2, gameHeight / 2, 'bgMenu');
    bgMenu.setDisplaySize(gameWidth, gameHeight);
    bgMenu.setAlpha(0.85); // –î–µ–ª–∞–µ–º –Ω–µ–º–Ω–æ–≥–æ –ø—Ä–æ–∑—Ä–∞—á–Ω—ã–º –¥–ª—è –º—è–≥–∫–æ–≥–æ —ç—Ñ—Ñ–µ–∫—Ç–∞

    // –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ —Å–±—Ä–∞—Å—ã–≤–∞–µ–º –±–∞–ª–∞–Ω—Å –¥–ª—è —Ä–µ—à–µ–Ω–∏—è –ø—Ä–æ–±–ª–µ–º —Å –∫–µ—à–µ–º
    GameData.resetDiamonds();

    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ –∑–≤—É–∫–∞
    SoundManager.getMuteState();
    
    // –ó–∞–ø—É—Å–∫–∞–µ–º —Ñ–æ–Ω–æ–≤—É—é –º—É–∑—ã–∫—É –º–µ–Ω—é
    SoundManager.playMusic(this, 'MM', 0.008);
    
    // –ö–Ω–æ–ø–∫–∞ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∑–≤—É–∫–æ–º –≤ –ø—Ä–∞–≤–æ–º –≤–µ—Ä—Ö–Ω–µ–º —É–≥–ª—É
    this.createSoundButton(gameWidth * 0.9, gameHeight * 0.1);

    // –õ–æ–≥–æ—Ç–∏–ø –∫–æ–º–ø–∞–Ω–∏–∏
    const logo = this.add.image(gameWidth / 2, gameHeight * 0.15, 'logo');
    logo.setDisplaySize(gameWidth * 0.6, gameHeight * 0.12);

    // –ù–æ–≤—ã–µ –∫–Ω–æ–ø–∫–∏ –º–µ–Ω—é —Å–æ —Å–ø—Ä–∞–π—Ç–∞–º–∏ (—Å–∫–æ—Ä—Ä–µ–∫—Ç–∏—Ä–æ–≤–∞–Ω —Ä–∞–∑–º–µ—Ä —Ç–µ–∫—Å—Ç–∞)
    // –ö–Ω–æ–ø–∫–∞ "–ò–≥—Ä–∞—Ç—å"
    const gameButtonBg = this.add.image(gameWidth * 0.25, gameHeight * 0.42, 'gameR');
    gameButtonBg.setDisplaySize(gameWidth * 0.4, gameHeight * 0.08);
    gameButtonBg.setInteractive();
    const gameButtonText = this.add.image(gameWidth * 0.25, gameHeight * 0.42, 'game');
    gameButtonText.setDisplaySize(gameWidth * 0.25, gameHeight * 0.04);
    
    gameButtonBg.on('pointerdown', () => {
      this.scene.start('MainScene');
    });

    // –ö–Ω–æ–ø–∫–∞ "–ú–∞–≥–∞–∑–∏–Ω"
    const shopButtonBg = this.add.image(gameWidth * 0.25, gameHeight * 0.54, 'shopR');
    shopButtonBg.setDisplaySize(gameWidth * 0.4, gameHeight * 0.08);
    shopButtonBg.setInteractive();
    const shopButtonText = this.add.image(gameWidth * 0.25, gameHeight * 0.54, 'shop');
    shopButtonText.setDisplaySize(gameWidth * 0.25, gameHeight * 0.04);
    
    shopButtonBg.on('pointerdown', () => {
      this.scene.start('ShopScene');
    });

    // –ö–Ω–æ–ø–∫–∞ "–ê–∫—Ü–∏–∏"
    const actionButtonBg = this.add.image(gameWidth * 0.25, gameHeight * 0.66, 'actionR');
    actionButtonBg.setDisplaySize(gameWidth * 0.4, gameHeight * 0.08);
    actionButtonBg.setInteractive();
    const actionButtonText = this.add.image(gameWidth * 0.25, gameHeight * 0.66, 'action');
    actionButtonText.setDisplaySize(gameWidth * 0.25, gameHeight * 0.04);
    
    actionButtonBg.on('pointerdown', () => {
      this.scene.start('PromotionsScene');
    });

    // –ö–Ω–æ–ø–∫–∞ "–¢–∞–±–ª–∏—Ü–∞ –ª–∏–¥–µ—Ä–æ–≤"
    const leaderButtonBg = this.add.image(gameWidth * 0.25, gameHeight * 0.78, 'leaderboardR');
    leaderButtonBg.setDisplaySize(gameWidth * 0.4, gameHeight * 0.1);
    leaderButtonBg.setInteractive();
    const leaderButtonText = this.add.image(gameWidth * 0.25, gameHeight * 0.78, 'leaderboard');
    leaderButtonText.setDisplaySize(gameWidth * 0.3, gameHeight * 0.06);
    
    leaderButtonBg.on('pointerdown', () => {
      this.scene.start('LeaderboardScene');
    });

    // –î–æ–±–∞–≤–ª—è–µ–º –ø–µ—Ä—Å–æ–Ω–∞–∂–∞ –≤ –ø—Ä–∞–≤—É—é —á–∞—Å—Ç—å —ç–∫—Ä–∞–Ω–∞ (–æ—Ç–∑–µ—Ä–∫–∞–ª–µ–Ω–Ω—ã–π, –ø—Ä–∏–ø–æ–¥–Ω—è—Ç—ã–π)
    const character = this.add.image(gameWidth * 0.75, gameHeight * 0.7, 'man1');
    character.setDisplaySize(gameWidth * 0.45, gameHeight * 0.7);
    character.setFlipX(true); // –û—Ç–∑–µ—Ä–∫–∞–ª–∏–≤–∞–µ–º –≥–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω–æ
    
    // –ê–Ω–∏–º–∞—Ü–∏—è –ø–µ—Ä—Å–æ–Ω–∞–∂–∞ (–ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –º–µ–∂–¥—É man1 –∏ man2)
    this.time.addEvent({
      delay: 2000,
      callback: () => {
        if (character.texture.key === 'man1') {
          character.setTexture('man2');
        } else {
          character.setTexture('man1');
        }
      },
      repeat: -1
    });
  }
  
  createSoundButton(x, y) {
    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ –∑–≤—É–∫–∞
    SoundManager.getMuteState();
    
    // –°–æ–∑–¥–∞–µ–º –∫–Ω–æ–ø–∫—É –∑–≤—É–∫–∞
    const soundButton = this.add.text(x, y, SoundManager.isMuted ? 'üîá' : 'üîä', {
      font: 'bold 32px Arial',
      fill: '#FFEE00',
      stroke: '#222222',
      strokeThickness: 2
    }).setOrigin(0.5).setInteractive();
    
    soundButton.on('pointerdown', () => {
      // –ü—Ä–æ—Å—Ç–æ–µ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –∑–≤—É–∫–∞ –±–µ–∑ —Å–ª–æ–∂–Ω—ã—Ö overlay
      SoundManager.toggleMute();
      soundButton.setText(SoundManager.isMuted ? 'üîá' : 'üîä');
      SoundManager.updateMuteState(this);
      
      // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ
      this.showSoundNotification(x, y - 60);
    });
    
    soundButton.on('pointerover', () => {
      soundButton.setScale(1.2);
    });
    
    soundButton.on('pointerout', () => {
      soundButton.setScale(1);
    });
  }
  
  showSoundNotification(x, y) {
    // –°–æ–∑–¥–∞–µ–º –≤—Ä–µ–º–µ–Ω–Ω–æ–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ
    const notification = this.add.text(x, y, SoundManager.isMuted ? '–ó–í–£–ö –í–´–ö–õ–Æ–ß–ï–ù' : '–ó–í–£–ö –í–ö–õ–Æ–ß–Å–ù', {
      font: 'bold 16px Commissioner',
      fill: SoundManager.isMuted ? '#FF4444' : '#44FF44',
      stroke: '#222222',
      strokeThickness: 2
    }).setOrigin(0.5);
    
    // –ê–Ω–∏–º–∞—Ü–∏—è –ø–æ—è–≤–ª–µ–Ω–∏—è –∏ –∏—Å—á–µ–∑–Ω–æ–≤–µ–Ω–∏—è
    this.tweens.add({
      targets: notification,
      alpha: 0,
      y: y - 30,
      duration: 2000,
      ease: 'Power2',
      onComplete: () => {
        notification.destroy();
      }
    });
  }
}

// –ú–∞–≥–∞–∑–∏–Ω
class ShopScene extends Phaser.Scene {
  constructor() {
    super('ShopScene');
  }

  preload() {
    // –ó–∞–≥—Ä—É–∂–∞–µ–º —Ñ–æ–Ω –º–µ–Ω—é –¥–ª—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏
    this.load.image('bgMenu', 'bgMenu.png');
    // –ó–∞–≥—Ä—É–∂–∞–µ–º —Å–ø—Ä–∞–π—Ç—ã –º–æ–Ω–µ—Ç
    this.load.image('coin1', 'coin1.png');
    this.load.image('coin2', 'coin2.png');
    
    // –ó–∞–≥—Ä—É–∂–∞–µ–º –∑–≤—É–∫–∏
    this.load.audio('MM', 'MM.mp3');
    this.load.audio('coin', 'coin.mp3');
  }

  create() {
    const gameWidth = this.sys.game.config.width;
    const gameHeight = this.sys.game.config.height;

    // –§–æ–Ω –º–∞–≥–∞–∑–∏–Ω–∞
    const bgShop = this.add.image(gameWidth / 2, gameHeight / 2, 'bgMenu');
    bgShop.setDisplaySize(gameWidth, gameHeight);
    bgShop.setAlpha(0.7); // –î–µ–ª–∞–µ–º –Ω–µ–º–Ω–æ–≥–æ –ø—Ä–æ–∑—Ä–∞—á–Ω—ã–º –¥–ª—è –ª—É—á—à–µ–π —á–∏—Ç–∞–µ–º–æ—Å—Ç–∏

    // –ó–∞–ø—É—Å–∫–∞–µ–º —Ñ–æ–Ω–æ–≤—É—é –º—É–∑—ã–∫—É –º–µ–Ω—é
    SoundManager.playMusic(this, 'MM', 0.008);
    
    // –ö–Ω–æ–ø–∫–∞ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∑–≤—É–∫–æ–º –≤ –ø—Ä–∞–≤–æ–º –≤–µ—Ä—Ö–Ω–µ–º —É–≥–ª—É
    this.createSoundButton(gameWidth * 0.9, gameHeight * 0.1);

    // –ó–∞–≥–æ–ª–æ–≤–æ–∫
    this.add.text(gameWidth / 2, gameHeight * 0.08, '–ú–ê–ì–ê–ó–ò–ù –ó–ê–ü–ß–ê–°–¢–ï–ô', {
      font: 'bold 32px Commissioner',
      fill: '#FFEE00',
      stroke: '#222222',
      strokeThickness: 2
    }).setOrigin(0.5);

    // –ë–∞–ª–∞–Ω—Å
    const diamonds = GameData.getDiamonds();
    const balanceCoinIcon = this.add.image(gameWidth / 2 - 40, gameHeight * 0.15, 'coin1');
    balanceCoinIcon.setDisplaySize(gameWidth * 0.09, gameHeight * 0.06);
    this.diamondsText = this.add.text(gameWidth / 2 - 10, gameHeight * 0.15, `–ë–∞–ª–∞–Ω—Å: ${diamonds}`, {
      font: 'bold 22px Commissioner',
      fill: '#FFEE00',
      stroke: '#222222',
      strokeThickness: 1
    }).setOrigin(0, 0.5);

    // –¢–æ–≤–∞—Ä—ã
    const items = [
      { name: '–°–∫–∏–¥–∫–∞ 10%', price: 15, description: '–°–∫–∏–¥–∫–∞ –Ω–∞ –≤—Å–µ –ø–æ–∫—É–ø–∫–∏' },
      { name: '–°–∫–∏–¥–∫–∞ 15%', price: 25, description: '–£–≤–µ–ª–∏—á–µ–Ω–Ω–∞—è —Å–∫–∏–¥–∫–∞' },
      { name: '–°–∫–∏–¥–∫–∞ 20%', price: 50, description: '–ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è —Å–∫–∏–¥–∫–∞' },
      { name: '–ë—É–¥–∏–ª—å–Ω–∏–∫', price: 15, description: '–°–ø–µ—Ü–∏–∞–ª—å–Ω—ã–π –ø—Ä–µ–¥–º–µ—Ç' }
    ];

    items.forEach((item, index) => {
      const y = gameHeight * 0.25 + index * (gameHeight * 0.1);
      this.createShopItem(gameWidth / 2, y, item);
    });

    // –ö–Ω–æ–ø–∫–∞ –Ω–∞–∑–∞–¥
    this.createBackButton(gameWidth * 0.15, gameHeight * 0.9, '–ù–ê–ó–ê–î', () => {
      this.scene.start('MenuScene');
    });
  }

  createShopButton(x, y, text, callback) {
    // –°–æ–∑–¥–∞–µ–º —Ñ–æ–Ω –∫–Ω–æ–ø–∫–∏ —Å–æ —Å–∫—Ä—É–≥–ª–µ–Ω–∏—è–º–∏
    const buttonBg = this.add.graphics();
    buttonBg.fillStyle(0xFFEE00);
    buttonBg.fillRoundedRect(x - 40, y - 15, 80, 30, 12);
    buttonBg.lineStyle(2, 0x222222);
    buttonBg.strokeRoundedRect(x - 40, y - 15, 80, 30, 12);

    const button = this.add.text(x, y, text, {
      font: 'bold 12px Commissioner',
      fill: '#222222'
    })
      .setOrigin(0.5)
      .setInteractive()
      .on('pointerdown', callback)
      .on('pointerover', () => {
        buttonBg.clear();
        buttonBg.fillStyle(0x222222);
        buttonBg.fillRoundedRect(x - 40, y - 15, 80, 30, 12);
        buttonBg.lineStyle(2, 0xFFEE00);
        buttonBg.strokeRoundedRect(x - 40, y - 15, 80, 30, 12);
        button.setFill('#FFEE00');
      })
      .on('pointerout', () => {
        buttonBg.clear();
        buttonBg.fillStyle(0xFFEE00);
        buttonBg.fillRoundedRect(x - 40, y - 15, 80, 30, 12);
        buttonBg.lineStyle(2, 0x222222);
        buttonBg.strokeRoundedRect(x - 40, y - 15, 80, 30, 12);
        button.setFill('#222222');
      });
    return button;
  }

  createBackButton(x, y, text, callback) {
    // –°–æ–∑–¥–∞–µ–º —Ñ–æ–Ω –∫–Ω–æ–ø–∫–∏ —Å–æ —Å–∫—Ä—É–≥–ª–µ–Ω–∏—è–º–∏
    const buttonBg = this.add.graphics();
    buttonBg.fillStyle(0x222222);
    buttonBg.fillRoundedRect(x - 50, y - 20, 100, 40, 15);
    buttonBg.lineStyle(2, 0xC8C8C8);
    buttonBg.strokeRoundedRect(x - 50, y - 20, 100, 40, 15);

    const button = this.add.text(x, y, text, {
      font: 'bold 16px Commissioner',
      fill: '#C8C8C8'
    })
      .setOrigin(0.5)
      .setInteractive()
      .on('pointerdown', callback)
      .on('pointerover', () => {
        buttonBg.clear();
        buttonBg.fillStyle(0xC8C8C8);
        buttonBg.fillRoundedRect(x - 50, y - 20, 100, 40, 15);
        buttonBg.lineStyle(2, 0x222222);
        buttonBg.strokeRoundedRect(x - 50, y - 20, 100, 40, 15);
        button.setFill('#222222');
      })
      .on('pointerout', () => {
        buttonBg.clear();
        buttonBg.fillStyle(0x222222);
        buttonBg.fillRoundedRect(x - 50, y - 20, 100, 40, 15);
        buttonBg.lineStyle(2, 0xC8C8C8);
        buttonBg.strokeRoundedRect(x - 50, y - 20, 100, 40, 15);
        button.setFill('#C8C8C8');
      });
    return button;
  }

  createShopItem(x, y, item) {
    const gameWidth = this.sys.game.config.width;
    const gameHeight = this.sys.game.config.height;
    
    // –§–æ–Ω —Ç–æ–≤–∞—Ä–∞ (—É–º–µ–Ω—å—à–µ–Ω–∞ —à–∏—Ä–∏–Ω–∞ –¥–ª—è –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏—è –æ–±—Ä–µ–∑–∞–Ω–∏—è)
    const itemBg = this.add.graphics();
    itemBg.fillStyle(0xC8C8C8, 0.2);
    itemBg.fillRoundedRect(x - gameWidth * 0.38, y - gameHeight * 0.03, gameWidth * 0.76, gameHeight * 0.06, 12);
    itemBg.lineStyle(2, 0xC8C8C8);
    itemBg.strokeRoundedRect(x - gameWidth * 0.38, y - gameHeight * 0.03, gameWidth * 0.76, gameHeight * 0.06, 12);

    // –ù–∞–∑–≤–∞–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞
    this.add.text(x - gameWidth * 0.32, y - gameHeight * 0.012, item.name, {
      font: 'bold 16px Commissioner',
      fill: '#FFEE00',
      stroke: '#222222',
      strokeThickness: 1
    }).setOrigin(0, 0.5);

    // –û–ø–∏—Å–∞–Ω–∏–µ
    this.add.text(x - gameWidth * 0.32, y + gameHeight * 0.012, item.description, {
      font: '12px Commissioner',
      fill: '#FFFFFF'
    }).setOrigin(0, 0.5);

    // –¶–µ–Ω–∞ —Å –∏–∫–æ–Ω–∫–æ–π –º–æ–Ω–µ—Ç—ã
    const priceCoinIcon = this.add.image(x + gameWidth * 0.05, y + gameHeight * 0.005 - 5 + 3, 'coin1');
    priceCoinIcon.setDisplaySize(gameWidth * 0.08, gameHeight * 0.06);
    this.add.text(x + gameWidth * 0.08, y - gameHeight * 0.008 + 2 + 5 - 3, `${item.price}`, {
      font: 'bold 19px Commissioner',
      fill: '#FFEE00',
      stroke: '#222222',
      strokeThickness: 1
    }).setOrigin(0, 0.5);

    // –ö–Ω–æ–ø–∫–∞ –∫—É–ø–∏—Ç—å (–ø–æ–¥–Ω—è—Ç–∞ –Ω–∞ —É—Ä–æ–≤–µ–Ω—å —Ü–µ–Ω—Ç—Ä–∞ —ç–ª–µ–º–µ–Ω—Ç–∞)
    const buyButton = this.createShopButton(x + gameWidth * 0.28, y, '–ö–£–ü–ò–¢–¨', () => {
      this.buyItem(item);
    });
  }

  buyItem(item) {
    // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —è–≤–ª—è–µ—Ç—Å—è –ª–∏ —Ç–æ–≤–∞—Ä —Å–∫–∏–¥–∫–æ–π
    if (item.name.includes('–°–∫–∏–¥–∫–∞')) {
      this.showDiscountWarning(item);
    } else {
      if (GameData.spendDiamonds(item.price)) {
        // –í–æ—Å–ø—Ä–æ–∏–∑–≤–æ–¥–∏–º –∑–≤—É–∫ –ø–æ–∫—É–ø–∫–∏ (–º–æ–Ω–µ—Ç–∫–∞)
        SoundManager.playSound(this, 'coin', 1.8);
        this.showPurchaseConfirmation(item);
        this.updateDiamondsDisplay();
      } else {
        this.showMessage('–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –º–æ–Ω–µ—Ç!');
      }
    }
  }

  showDiscountWarning(item) {
    const gameWidth = this.sys.game.config.width;
    const gameHeight = this.sys.game.config.height;

    // –ó–∞—Ç–µ–º–Ω–µ–Ω–∏–µ
    const overlay = this.add.rectangle(gameWidth / 2, gameHeight / 2, gameWidth, gameHeight, 0x000000, 0.7);

    // –û–∫–Ω–æ –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è (—É–≤–µ–ª–∏—á–µ–Ω–æ –ø–æ –≤—ã—Å–æ—Ç–µ –¥–ª—è –¥–≤—É—Ö —Ä—è–¥–æ–≤ –∫–Ω–æ–ø–æ–∫)
    const warningBox = this.add.rectangle(gameWidth / 2, gameHeight / 2, gameWidth * 0.85, gameHeight * 0.6, 0x333333);
    warningBox.setStrokeStyle(3, 0xFFFF00);

    const titleText = this.add.text(gameWidth / 2, gameHeight / 2 - gameHeight * 0.2, '–í–ù–ò–ú–ê–ù–ò–ï!', {
      font: 'bold 24px Arial',
      fill: '#FFFF00',
      stroke: '#000',
      strokeThickness: 2
    }).setOrigin(0.5);

    const warningText = this.add.text(gameWidth / 2, gameHeight / 2 - gameHeight * 0.08, 
      '–ü–æ—Å–ª–µ –ø–æ–∫—É–ø–∫–∏ –≤—ã –Ω–∞–ø—Ä–∞–≤–ª—è–µ—Ç–µ—Å—å\n–Ω–∞ —É–Ω–∏–∫–∞–ª—å–Ω—É—é —Ñ–æ—Ä–º—É –∑–∞–ø–∏—Å–∏.\n\n–¢–û–õ–¨–ö–û –ü–û –ù–ï–ô –í–´ –°–ú–û–ñ–ï–¢–ï\n–ü–û–õ–£–ß–ò–¢–¨ –°–ö–ò–î–ö–£!', {
      font: 'bold 16px Arial',
      fill: '#fff',
      stroke: '#000',
      strokeThickness: 1,
      align: 'center'
    }).setOrigin(0.5);

    const continueButton = this.createButton(gameWidth / 2, gameHeight / 2 + gameHeight * 0.08, '–ü–†–û–î–û–õ–ñ–ò–¢–¨', {
      font: 'bold 16px Arial',
      fill: '#fff',
      backgroundColor: '#00aa00',
      stroke: '#000',
      strokeThickness: 2
    }, () => {
      if (GameData.spendDiamonds(item.price)) {
        this.destroyWarningDialog(overlay, warningBox, titleText, warningText, continueButton, cancelButton);
        this.showPurchaseConfirmation(item);
        this.updateDiamondsDisplay();
      } else {
        this.destroyWarningDialog(overlay, warningBox, titleText, warningText, continueButton, cancelButton);
        this.showMessage('–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –º–æ–Ω–µ—Ç!');
      }
    });

    const cancelButton = this.createButton(gameWidth / 2, gameHeight / 2 + gameHeight * 0.16, '–û–¢–ú–ï–ù–ê', {
      font: 'bold 16px Arial',
      fill: '#fff',
      backgroundColor: '#aa0000',
      stroke: '#000',
      strokeThickness: 2
    }, () => {
      this.destroyWarningDialog(overlay, warningBox, titleText, warningText, continueButton, cancelButton);
    });
  }

  destroyWarningDialog(overlay, warningBox, titleText, warningText, continueButton, cancelButton) {
    overlay.destroy();
    warningBox.destroy();
    titleText.destroy();
    warningText.destroy();
    continueButton.destroy();
    cancelButton.destroy();
  }

  showPurchaseConfirmation(item) {
    const gameWidth = this.sys.game.config.width;
    const gameHeight = this.sys.game.config.height;

    // –ó–∞—Ç–µ–º–Ω–µ–Ω–∏–µ
    const overlay = this.add.rectangle(gameWidth / 2, gameHeight / 2, gameWidth, gameHeight, 0x000000, 0.7);

    // –û–∫–Ω–æ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è (—É–≤–µ–ª–∏—á–µ–Ω–æ –ø–æ –≤—ã—Å–æ—Ç–µ –¥–ª—è –¥–≤—É—Ö —Ä—è–¥–æ–≤ –∫–Ω–æ–ø–æ–∫)
    const confirmBox = this.add.rectangle(gameWidth / 2, gameHeight / 2, 400, 320, 0x333333);
    confirmBox.setStrokeStyle(3, 0xFFFFFF);

    const titleText = this.add.text(gameWidth / 2, gameHeight / 2 - 60, '–ü–û–ö–£–ü–ö–ê –°–û–í–ï–†–®–ï–ù–ê!', {
      font: 'bold 24px Arial',
      fill: '#00ff00',
      stroke: '#000',
      strokeThickness: 2
    }).setOrigin(0.5);

    const itemText = this.add.text(gameWidth / 2, gameHeight / 2 - 20, `${item.name} –ø—Ä–∏–æ–±—Ä–µ—Ç–µ–Ω!`, {
      font: '18px Arial',
      fill: '#fff'
    }).setOrigin(0.5);

    const questionText = this.add.text(gameWidth / 2, gameHeight / 2 + 10, '–ü–µ—Ä–µ–π—Ç–∏ –Ω–∞ —Å–∞–π—Ç?', {
      font: '16px Arial',
      fill: '#ccc'
    }).setOrigin(0.5);

    const yesButton = this.createButton(gameWidth / 2, gameHeight / 2 + 40, '–î–ê', {
      font: 'bold 20px Arial',
      fill: '#fff',
      backgroundColor: '#00aa00',
      stroke: '#000',
      strokeThickness: 2
    }, () => {
      this.openLink('https://koreanaparts.ru/block/119');
      this.destroyConfirmDialog(overlay, confirmBox, titleText, itemText, questionText, yesButton, noButton);
    });

    const noButton = this.createButton(gameWidth / 2, gameHeight / 2 + 100, '–ù–ï–¢', {
      font: 'bold 20px Arial',
      fill: '#fff',
      backgroundColor: '#aa0000',
      stroke: '#000',
      strokeThickness: 2
    }, () => {
      this.destroyConfirmDialog(overlay, confirmBox, titleText, itemText, questionText, yesButton, noButton);
    });
  }

  destroyConfirmDialog(overlay, confirmBox, titleText, itemText, questionText, yesButton, noButton) {
    overlay.destroy();
    confirmBox.destroy();
    titleText.destroy();
    itemText.destroy();
    questionText.destroy();
    yesButton.destroy();
    noButton.destroy();
  }

  openLink(url) {
    // –î–ª—è –º–æ–±–∏–ª—å–Ω—ã—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤ –∏—Å–ø–æ–ª—å–∑—É–µ–º location.href
    if (this.sys.game.device.os.iOS || this.sys.game.device.os.android) {
      location.href = url;
    } else {
      window.open(url, '_blank');
    }
  }

  showMessage(text) {
    const gameHeight = this.sys.game.config.height;
    
    // –°–æ–∑–¥–∞–µ–º —Ñ–æ–Ω —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
    const messageBg = this.add.graphics();
    messageBg.fillStyle(0x222222, 0.9);
    messageBg.fillRoundedRect(this.sys.game.config.width / 2 - 150, gameHeight * 0.85 - 25, 300, 50, 15);
    messageBg.lineStyle(2, 0xFFEE00);
    messageBg.strokeRoundedRect(this.sys.game.config.width / 2 - 150, gameHeight * 0.85 - 25, 300, 50, 15);
    
    const message = this.add.text(this.sys.game.config.width / 2, gameHeight * 0.85, text, {
      font: 'bold 16px Commissioner',
      fill: '#FFEE00',
      align: 'center'
    }).setOrigin(0.5);

    this.time.delayedCall(2000, () => {
      message.destroy();
      messageBg.destroy();
    });
  }

  updateDiamondsDisplay() {
    const diamonds = GameData.getDiamonds();
    this.diamondsText.setText(`–ë–∞–ª–∞–Ω—Å: ${diamonds}`);
    this.diamondsText.setStyle({
      font: 'bold 22px Commissioner',
      fill: '#FFEE00',
      stroke: '#222222',
      strokeThickness: 1
    });
  }

  createButton(x, y, text, style, callback) {
    const button = this.add.text(x, y, text, style)
      .setOrigin(0.5)
      .setPadding(15, 10)
      .setInteractive()
      .on('pointerdown', callback)
      .on('pointerover', () => {
        button.setScale(1.1);
      })
      .on('pointerout', () => {
        button.setScale(1);
      });
    return button;
  }

  createSoundButton(x, y) {
    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ –∑–≤—É–∫–∞
    SoundManager.getMuteState();
    
    // –°–æ–∑–¥–∞–µ–º –∫–Ω–æ–ø–∫—É –∑–≤—É–∫–∞
    const soundButton = this.add.text(x, y, SoundManager.isMuted ? 'üîá' : 'üîä', {
      font: 'bold 32px Arial',
      fill: '#FFEE00',
      stroke: '#222222',
      strokeThickness: 2
    }).setOrigin(0.5).setInteractive();
    
    soundButton.on('pointerdown', () => {
      // –ü—Ä–æ—Å—Ç–æ–µ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –∑–≤—É–∫–∞ –±–µ–∑ —Å–ª–æ–∂–Ω—ã—Ö overlay
      SoundManager.toggleMute();
      soundButton.setText(SoundManager.isMuted ? 'üîá' : 'üîä');
      SoundManager.updateMuteState(this);
      
      // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ
      this.showSoundNotification(x, y - 60);
    });
    
    soundButton.on('pointerover', () => {
      soundButton.setScale(1.2);
    });
    
    soundButton.on('pointerout', () => {
      soundButton.setScale(1);
    });
  }
  
  showSoundNotification(x, y) {
    // –°–æ–∑–¥–∞–µ–º –≤—Ä–µ–º–µ–Ω–Ω–æ–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ
    const notification = this.add.text(x, y, SoundManager.isMuted ? '–ó–í–£–ö –í–´–ö–õ–Æ–ß–ï–ù' : '–ó–í–£–ö –í–ö–õ–Æ–ß–Å–ù', {
      font: 'bold 16px Commissioner',
      fill: SoundManager.isMuted ? '#FF4444' : '#44FF44',
      stroke: '#222222',
      strokeThickness: 2
    }).setOrigin(0.5);
    
    // –ê–Ω–∏–º–∞—Ü–∏—è –ø–æ—è–≤–ª–µ–Ω–∏—è –∏ –∏—Å—á–µ–∑–Ω–æ–≤–µ–Ω–∏—è
    this.tweens.add({
      targets: notification,
      alpha: 0,
      y: y - 30,
      duration: 2000,
      ease: 'Power2',
      onComplete: () => {
        notification.destroy();
      }
    });
  }
}

// –ê–∫—Ü–∏–∏
class PromotionsScene extends Phaser.Scene {
  constructor() {
    super('PromotionsScene');
  }

  preload() {
    // –ó–∞–≥—Ä—É–∂–∞–µ–º —Ñ–æ–Ω –º–µ–Ω—é –¥–ª—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏
    this.load.image('bgMenu', 'bgMenu.png');
    
    // –ó–∞–≥—Ä—É–∂–∞–µ–º –∑–≤—É–∫–∏
    this.load.audio('MM', 'MM.mp3');
    this.load.audio('coin', 'coin.mp3');
  }

  create() {
    const gameWidth = this.sys.game.config.width;
    const gameHeight = this.sys.game.config.height;

    // –§–æ–Ω –∞–∫—Ü–∏–π
    const bgPromo = this.add.image(gameWidth / 2, gameHeight / 2, 'bgMenu');
    bgPromo.setDisplaySize(gameWidth, gameHeight);
    bgPromo.setAlpha(0.6); // –î–µ–ª–∞–µ–º –Ω–µ–º–Ω–æ–≥–æ –ø—Ä–æ–∑—Ä–∞—á–Ω—ã–º –¥–ª—è –ª—É—á—à–µ–π —á–∏—Ç–∞–µ–º–æ—Å—Ç–∏

    // –ó–∞–ø—É—Å–∫–∞–µ–º —Ñ–æ–Ω–æ–≤—É—é –º—É–∑—ã–∫—É –º–µ–Ω—é
    SoundManager.playMusic(this, 'MM', 0.008);
    
    // –ö–Ω–æ–ø–∫–∞ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∑–≤—É–∫–æ–º –≤ –ø—Ä–∞–≤–æ–º –≤–µ—Ä—Ö–Ω–µ–º —É–≥–ª—É
    this.createSoundButton(gameWidth * 0.9, gameHeight * 0.1);

    // –ó–∞–≥–æ–ª–æ–≤–æ–∫ –≤ –¥–≤–µ —Å—Ç—Ä–æ–∫–∏
    this.add.text(gameWidth / 2, gameHeight * 0.05, '–ê–ö–¶–ò–ò –ò', {
      font: 'bold 28px Commissioner',
      fill: '#FFEE00',
      stroke: '#222222',
      strokeThickness: 2
    }).setOrigin(0.5);

    this.add.text(gameWidth / 2, gameHeight * 0.1, '–ü–†–ï–î–õ–û–ñ–ï–ù–ò–Ø', {
      font: 'bold 28px Commissioner',
      fill: '#FFEE00',
      stroke: '#222222',
      strokeThickness: 2
    }).setOrigin(0.5);

    // –ï–∂–µ–¥–Ω–µ–≤–Ω–∞—è —Ä–µ–∫–ª–∞–º–∞
    this.createDailyReward(gameWidth / 2, gameHeight * 0.25);
    
    // –î–≤–æ–π–Ω—ã–µ –º–æ–Ω–µ—Ç—ã –≤ –≤—ã—Ö–æ–¥–Ω—ã–µ
    this.createPromotion(gameWidth / 2, gameHeight * 0.38, '–î–≤–æ–π–Ω—ã–µ –º–æ–Ω–µ—Ç—ã –≤ –≤—ã—Ö–æ–¥–Ω—ã–µ!', null);
    
    // –°–ø–µ—Ü–∏–∞–ª—å–Ω–æ–µ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ –Ω–µ–¥–µ–ª–∏
    this.createPromotion(gameWidth / 2, gameHeight * 0.51, '–°–ø–µ—Ü–∏–∞–ª—å–Ω–æ–µ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ –Ω–µ–¥–µ–ª–∏', () => {
      this.openLink('https://koreanaparts.ru/specpredlozheniya-i-akcii-kompanii-koreana-sankt-peterburg');
    });
    
    // –ú–µ–º –∑–∞ –º–æ–Ω–µ—Ç—É
    this.createPromotion(gameWidth / 2, gameHeight * 0.64, '–ú–µ–º –∑–∞ –º–æ–Ω–µ—Ç—É', () => {
      this.openLink('https://www.anekdot.ru/last/mem/');
    });

    // –ö–Ω–æ–ø–∫–∞ –Ω–∞–∑–∞–¥
    this.createBackButton(gameWidth * 0.15, gameHeight * 0.82, '–ù–ê–ó–ê–î', () => {
      this.scene.start('MenuScene');
    });
  }

  createBackButton(x, y, text, callback) {
    // –°–æ–∑–¥–∞–µ–º —Ñ–æ–Ω –∫–Ω–æ–ø–∫–∏ —Å–æ —Å–∫—Ä—É–≥–ª–µ–Ω–∏—è–º–∏
    const buttonBg = this.add.graphics();
    buttonBg.fillStyle(0x222222);
    buttonBg.fillRoundedRect(x - 50, y - 20, 100, 40, 15);
    buttonBg.lineStyle(2, 0xC8C8C8);
    buttonBg.strokeRoundedRect(x - 50, y - 20, 100, 40, 15);

    const button = this.add.text(x, y, text, {
      font: 'bold 16px Commissioner',
      fill: '#C8C8C8'
    })
      .setOrigin(0.5)
      .setInteractive()
      .on('pointerdown', callback)
      .on('pointerover', () => {
        buttonBg.clear();
        buttonBg.fillStyle(0xC8C8C8);
        buttonBg.fillRoundedRect(x - 50, y - 20, 100, 40, 15);
        buttonBg.lineStyle(2, 0x222222);
        buttonBg.strokeRoundedRect(x - 50, y - 20, 100, 40, 15);
        button.setFill('#222222');
      })
      .on('pointerout', () => {
        buttonBg.clear();
        buttonBg.fillStyle(0x222222);
        buttonBg.fillRoundedRect(x - 50, y - 20, 100, 40, 15);
        buttonBg.lineStyle(2, 0xC8C8C8);
        buttonBg.strokeRoundedRect(x - 50, y - 20, 100, 40, 15);
        button.setFill('#C8C8C8');
      });
    return button;
  }

  createDailyReward(x, y) {
    const gameWidth = this.sys.game.config.width;
    const gameHeight = this.sys.game.config.height;
    const canClaim = GameData.canClaimDailyReward();
    
    const promoBg = this.add.graphics();
    const bgColor = canClaim ? 0xFFEE00 : 0xC8C8C8;
    const strokeColor = canClaim ? 0x222222 : 0x666666;
    promoBg.fillStyle(bgColor, 0.2);
    promoBg.fillRoundedRect(x - gameWidth * 0.38, y - gameHeight * 0.03, gameWidth * 0.76, gameHeight * 0.06, 12);
    promoBg.lineStyle(2, strokeColor);
    promoBg.strokeRoundedRect(x - gameWidth * 0.38, y - gameHeight * 0.03, gameWidth * 0.76, gameHeight * 0.06, 12);

    const text = canClaim ? '–ï–∂–µ–¥–Ω–µ–≤–Ω–∞—è —Ä–µ–∫–ª–∞–º–∞ +1 –º–æ–Ω–µ—Ç–∞ (–î–æ—Å—Ç—É–ø–Ω–æ!)' : '–ï–∂–µ–¥–Ω–µ–≤–Ω–∞—è —Ä–µ–∫–ª–∞–º–∞ +1 –º–æ–Ω–µ—Ç–∞ (–ù–µ–¥–æ—Å—Ç—É–ø–Ω–æ)';
    const color = canClaim ? '#222222' : '#666666';
    
    const rewardText = this.add.text(x, y, text, {
      font: 'bold 14px Commissioner',
      fill: color
    }).setOrigin(0.5);

    if (canClaim) {
      rewardText.setInteractive()
        .on('pointerdown', () => {
          if (GameData.claimDailyReward()) {
            SoundManager.playSound(this, 'coin', 1.8);
            this.showMessage('–ü–æ–ª—É—á–µ–Ω–∞ 1 –º–æ–Ω–µ—Ç–∞! –í–æ–∑–≤—Ä–∞—â–∞–π—Ç–µ—Å—å –∑–∞–≤—Ç—Ä–∞!');
            rewardText.setText('–ï–∂–µ–¥–Ω–µ–≤–Ω–∞—è —Ä–µ–∫–ª–∞–º–∞ +1 –º–æ–Ω–µ—Ç–∞ (–ù–µ–¥–æ—Å—Ç—É–ø–Ω–æ)');
            rewardText.setFill('#666666');
            // –ü–µ—Ä–µ—Ä–∏—Å–æ–≤—ã–≤–∞–µ–º —Ñ–æ–Ω
            promoBg.clear();
            promoBg.fillStyle(0xC8C8C8, 0.2);
            promoBg.fillRoundedRect(x - gameWidth * 0.38, y - gameHeight * 0.03, gameWidth * 0.76, gameHeight * 0.06, 12);
            promoBg.lineStyle(2, 0x666666);
            promoBg.strokeRoundedRect(x - gameWidth * 0.38, y - gameHeight * 0.03, gameWidth * 0.76, gameHeight * 0.06, 12);
            rewardText.removeInteractive();
          }
        })
        .on('pointerover', () => {
          rewardText.setScale(1.05);
        })
        .on('pointerout', () => {
          rewardText.setScale(1);
        });
    }
  }

  createPromotion(x, y, text, callback) {
    const gameWidth = this.sys.game.config.width;
    const gameHeight = this.sys.game.config.height;
    
    const promoBg = this.add.graphics();
    const bgColor = callback ? 0x222222 : 0xC8C8C8;
    const strokeColor = callback ? 0xFFEE00 : 0x222222;
    promoBg.fillStyle(bgColor, 0.2);
    promoBg.fillRoundedRect(x - gameWidth * 0.38, y - gameHeight * 0.03, gameWidth * 0.76, gameHeight * 0.06, 12);
    promoBg.lineStyle(2, strokeColor);
    promoBg.strokeRoundedRect(x - gameWidth * 0.38, y - gameHeight * 0.03, gameWidth * 0.76, gameHeight * 0.06, 12);

    const promoText = this.add.text(x, y, text, {
      font: 'bold 14px Commissioner',
      fill: callback ? '#FFEE00' : '#222222'
    }).setOrigin(0.5);

    if (callback) {
      promoText.setInteractive()
        .on('pointerdown', callback)
        .on('pointerover', () => {
          promoText.setScale(1.05);
          // –≠—Ñ—Ñ–µ–∫—Ç –Ω–∞–≤–µ–¥–µ–Ω–∏—è - –∏–Ω–≤–µ—Ä—Ç–∏—Ä—É–µ–º —Ü–≤–µ—Ç–∞
          promoBg.clear();
          promoBg.fillStyle(0xFFEE00, 0.2);
          promoBg.fillRoundedRect(x - gameWidth * 0.38, y - gameHeight * 0.03, gameWidth * 0.76, gameHeight * 0.06, 12);
          promoBg.lineStyle(2, 0x222222);
          promoBg.strokeRoundedRect(x - gameWidth * 0.38, y - gameHeight * 0.03, gameWidth * 0.76, gameHeight * 0.06, 12);
          promoText.setFill('#222222');
        })
        .on('pointerout', () => {
          promoText.setScale(1);
          // –í–æ–∑–≤—Ä–∞—â–∞–µ–º –æ–±—ã—á–Ω—ã–µ —Ü–≤–µ—Ç–∞
          promoBg.clear();
          promoBg.fillStyle(0x222222, 0.2);
          promoBg.fillRoundedRect(x - gameWidth * 0.38, y - gameHeight * 0.03, gameWidth * 0.76, gameHeight * 0.06, 12);
          promoBg.lineStyle(2, 0xFFEE00);
          promoBg.strokeRoundedRect(x - gameWidth * 0.38, y - gameHeight * 0.03, gameWidth * 0.76, gameHeight * 0.06, 12);
          promoText.setFill('#FFEE00');
        });
    }
  }

  showMessage(text) {
    const gameHeight = this.sys.game.config.height;
    
    // –°–æ–∑–¥–∞–µ–º —Ñ–æ–Ω —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
    const messageBg = this.add.graphics();
    messageBg.fillStyle(0x222222, 0.9);
    messageBg.fillRoundedRect(this.sys.game.config.width / 2 - 150, gameHeight * 0.85 - 25, 300, 50, 15);
    messageBg.lineStyle(2, 0xFFEE00);
    messageBg.strokeRoundedRect(this.sys.game.config.width / 2 - 150, gameHeight * 0.85 - 25, 300, 50, 15);
    
    const message = this.add.text(this.sys.game.config.width / 2, gameHeight * 0.85, text, {
      font: 'bold 16px Commissioner',
      fill: '#FFEE00',
      align: 'center'
    }).setOrigin(0.5);

    this.time.delayedCall(3000, () => {
      message.destroy();
      messageBg.destroy();
    });
  }

  openLink(url) {
    // –î–ª—è –º–æ–±–∏–ª—å–Ω—ã—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤ –∏—Å–ø–æ–ª—å–∑—É–µ–º location.href
    if (this.sys.game.device.os.iOS || this.sys.game.device.os.android) {
      location.href = url;
    } else {
      window.open(url, '_blank');
    }
  }

  createButton(x, y, text, style, callback) {
    const button = this.add.text(x, y, text, style)
      .setOrigin(0.5)
      .setPadding(15, 10)
      .setInteractive()
      .on('pointerdown', callback)
      .on('pointerover', () => {
        button.setScale(1.1);
      })
      .on('pointerout', () => {
        button.setScale(1);
      });
    return button;
  }

  createSoundButton(x, y) {
    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ –∑–≤—É–∫–∞
    SoundManager.getMuteState();
    
    // –°–æ–∑–¥–∞–µ–º –∫–Ω–æ–ø–∫—É –∑–≤—É–∫–∞
    const soundButton = this.add.text(x, y, SoundManager.isMuted ? 'üîá' : 'üîä', {
      font: 'bold 32px Arial',
      fill: '#FFEE00',
      stroke: '#222222',
      strokeThickness: 2
    }).setOrigin(0.5).setInteractive();
    
    soundButton.on('pointerdown', () => {
      // –ü—Ä–æ—Å—Ç–æ–µ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –∑–≤—É–∫–∞ –±–µ–∑ —Å–ª–æ–∂–Ω—ã—Ö overlay
      SoundManager.toggleMute();
      soundButton.setText(SoundManager.isMuted ? 'üîá' : 'üîä');
      SoundManager.updateMuteState(this);
      
      // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ
      this.showSoundNotification(x, y - 60);
    });
    
    soundButton.on('pointerover', () => {
      soundButton.setScale(1.2);
    });
    
    soundButton.on('pointerout', () => {
      soundButton.setScale(1);
    });
  }
  
  showSoundNotification(x, y) {
    // –°–æ–∑–¥–∞–µ–º –≤—Ä–µ–º–µ–Ω–Ω–æ–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ
    const notification = this.add.text(x, y, SoundManager.isMuted ? '–ó–í–£–ö –í–´–ö–õ–Æ–ß–ï–ù' : '–ó–í–£–ö –í–ö–õ–Æ–ß–Å–ù', {
      font: 'bold 16px Commissioner',
      fill: SoundManager.isMuted ? '#FF4444' : '#44FF44',
      stroke: '#222222',
      strokeThickness: 2
    }).setOrigin(0.5);
    
    // –ê–Ω–∏–º–∞—Ü–∏—è –ø–æ—è–≤–ª–µ–Ω–∏—è –∏ –∏—Å—á–µ–∑–Ω–æ–≤–µ–Ω–∏—è
    this.tweens.add({
      targets: notification,
      alpha: 0,
      y: y - 30,
      duration: 2000,
      ease: 'Power2',
      onComplete: () => {
        notification.destroy();
      }
    });
  }
}

// –¢–∞–±–ª–∏—Ü–∞ –ª–∏–¥–µ—Ä–æ–≤
class LeaderboardScene extends Phaser.Scene {
  constructor() {
    super('LeaderboardScene');
  }

  preload() {
    // –ó–∞–≥—Ä—É–∂–∞–µ–º —Ñ–æ–Ω –º–µ–Ω—é –¥–ª—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏
    this.load.image('bgMenu', 'bgMenu.png');
    
    // –ó–∞–≥—Ä—É–∂–∞–µ–º –∑–≤—É–∫–∏
    this.load.audio('MM', 'MM.mp3');
  }

  create() {
    const gameWidth = this.sys.game.config.width;
    const gameHeight = this.sys.game.config.height;

    // –§–æ–Ω —Ç–∞–±–ª–∏—Ü—ã –ª–∏–¥–µ—Ä–æ–≤
    const bgLeader = this.add.image(gameWidth / 2, gameHeight / 2, 'bgMenu');
    bgLeader.setDisplaySize(gameWidth, gameHeight);
    bgLeader.setAlpha(0.6); // –î–µ–ª–∞–µ–º –Ω–µ–º–Ω–æ–≥–æ –ø—Ä–æ–∑—Ä–∞—á–Ω—ã–º –¥–ª—è –ª—É—á—à–µ–π —á–∏—Ç–∞–µ–º–æ—Å—Ç–∏

    // –ó–∞–ø—É—Å–∫–∞–µ–º —Ñ–æ–Ω–æ–≤—É—é –º—É–∑—ã–∫—É –º–µ–Ω—é
    SoundManager.playMusic(this, 'MM', 0.008);
    
    // –ö–Ω–æ–ø–∫–∞ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∑–≤—É–∫–æ–º –≤ –ø—Ä–∞–≤–æ–º –≤–µ—Ä—Ö–Ω–µ–º —É–≥–ª—É
    this.createSoundButton(gameWidth * 0.9, gameHeight * 0.1);

    // –ó–∞–≥–æ–ª–æ–≤–æ–∫
    this.add.text(gameWidth / 2, gameHeight * 0.08, '–¢–ê–ë–õ–ò–¶–ê –õ–ò–î–ï–†–û–í', {
      font: 'bold 28px Commissioner',
      fill: '#FFEE00',
      stroke: '#222222',
      strokeThickness: 2
    }).setOrigin(0.5);

    // –ü–æ–ª—É—á–∞–µ–º —Ä–µ–∫–æ—Ä–¥—ã
    const scores = GameData.getTopScores();

    if (scores.length === 0) {
      this.add.text(gameWidth / 2, gameHeight * 0.4, '–ü–æ–∫–∞ –Ω–µ—Ç —Ä–µ–∫–æ—Ä–¥–æ–≤', {
        font: 'bold 20px Commissioner',
        fill: '#C8C8C8'
      }).setOrigin(0.5);
    } else {
      scores.forEach((score, index) => {
        const y = gameHeight * 0.22 + index * (gameHeight * 0.045);
        const medal = index < 3 ? ['ü•á', 'ü•à', 'ü•â'][index] : `${index + 1}.`;
        
        this.add.text(gameWidth / 2, y, `${medal} ${score} –æ—á–∫–æ–≤`, {
          font: 'bold 16px Commissioner',
          fill: '#FFEE00',
          stroke: '#222222',
          strokeThickness: 1
        }).setOrigin(0.5);
      });
    }

    // –ö–Ω–æ–ø–∫–∞ –Ω–∞–∑–∞–¥
    this.createBackButton(gameWidth * 0.15, gameHeight * 0.9, '–ù–ê–ó–ê–î', () => {
      this.scene.start('MenuScene');
    });
  }

  createBackButton(x, y, text, callback) {
    // –°–æ–∑–¥–∞–µ–º —Ñ–æ–Ω –∫–Ω–æ–ø–∫–∏ —Å–æ —Å–∫—Ä—É–≥–ª–µ–Ω–∏—è–º–∏
    const buttonBg = this.add.graphics();
    buttonBg.fillStyle(0x222222);
    buttonBg.fillRoundedRect(x - 50, y - 20, 100, 40, 15);
    buttonBg.lineStyle(2, 0xC8C8C8);
    buttonBg.strokeRoundedRect(x - 50, y - 20, 100, 40, 15);

    const button = this.add.text(x, y, text, {
      font: 'bold 16px Commissioner',
      fill: '#C8C8C8'
    })
      .setOrigin(0.5)
      .setInteractive()
      .on('pointerdown', callback)
      .on('pointerover', () => {
        buttonBg.clear();
        buttonBg.fillStyle(0xC8C8C8);
        buttonBg.fillRoundedRect(x - 50, y - 20, 100, 40, 15);
        buttonBg.lineStyle(2, 0x222222);
        buttonBg.strokeRoundedRect(x - 50, y - 20, 100, 40, 15);
        button.setFill('#222222');
      })
      .on('pointerout', () => {
        buttonBg.clear();
        buttonBg.fillStyle(0x222222);
        buttonBg.fillRoundedRect(x - 50, y - 20, 100, 40, 15);
        buttonBg.lineStyle(2, 0xC8C8C8);
        buttonBg.strokeRoundedRect(x - 50, y - 20, 100, 40, 15);
        button.setFill('#C8C8C8');
      });
    return button;
  }

  createButton(x, y, text, style, callback) {
    const button = this.add.text(x, y, text, style)
      .setOrigin(0.5)
      .setPadding(15, 10)
      .setInteractive()
      .on('pointerdown', callback)
      .on('pointerover', () => {
        button.setScale(1.1);
      })
      .on('pointerout', () => {
        button.setScale(1);
      });
    return button;
  }

  createSoundButton(x, y) {
    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ –∑–≤—É–∫–∞
    SoundManager.getMuteState();
    
    // –°–æ–∑–¥–∞–µ–º –∫–Ω–æ–ø–∫—É –∑–≤—É–∫–∞
    const soundButton = this.add.text(x, y, SoundManager.isMuted ? 'üîá' : 'üîä', {
      font: 'bold 32px Arial',
      fill: '#FFEE00',
      stroke: '#222222',
      strokeThickness: 2
    }).setOrigin(0.5).setInteractive();
    
    soundButton.on('pointerdown', () => {
      // –ü—Ä–æ—Å—Ç–æ–µ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –∑–≤—É–∫–∞ –±–µ–∑ —Å–ª–æ–∂–Ω—ã—Ö overlay
      SoundManager.toggleMute();
      soundButton.setText(SoundManager.isMuted ? 'üîá' : 'üîä');
      SoundManager.updateMuteState(this);
      
      // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ
      this.showSoundNotification(x, y - 60);
    });
    
    soundButton.on('pointerover', () => {
      soundButton.setScale(1.2);
    });
    
    soundButton.on('pointerout', () => {
      soundButton.setScale(1);
    });
  }
  
  showSoundNotification(x, y) {
    // –°–æ–∑–¥–∞–µ–º –≤—Ä–µ–º–µ–Ω–Ω–æ–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ
    const notification = this.add.text(x, y, SoundManager.isMuted ? '–ó–í–£–ö –í–´–ö–õ–Æ–ß–ï–ù' : '–ó–í–£–ö –í–ö–õ–Æ–ß–Å–ù', {
      font: 'bold 16px Commissioner',
      fill: SoundManager.isMuted ? '#FF4444' : '#44FF44',
      stroke: '#222222',
      strokeThickness: 2
    }).setOrigin(0.5);
    
    // –ê–Ω–∏–º–∞—Ü–∏—è –ø–æ—è–≤–ª–µ–Ω–∏—è –∏ –∏—Å—á–µ–∑–Ω–æ–≤–µ–Ω–∏—è
    this.tweens.add({
      targets: notification,
      alpha: 0,
      y: y - 30,
      duration: 2000,
      ease: 'Power2',
      onComplete: () => {
        notification.destroy();
      }
    });
  }
}

// –û—Å–Ω–æ–≤–Ω–∞—è –∏–≥—Ä–∞ (–º–æ–¥–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω–Ω–∞—è)
class MainScene extends Phaser.Scene {
  constructor() {
    super('MainScene');
    this.gameOverFlag = false;
    this.touchStartX = 0;
    this.touchStartY = 0;
    this.isTouching = false;
  }

  preload() {
    // –ú–∞—à–∏–Ω–∫–∏ –∏–≥—Ä–æ–∫–∞
    this.load.image('car', 'car.png');
    this.load.image('carL', 'carL.png');
    this.load.image('carR', 'carR.png');
    
    // –î–æ—Ä–æ–≥–∞ –∏ –æ–∫—Ä—É–∂–µ–Ω–∏–µ
    this.load.image('roadL', 'roadL.png');
    this.load.image('roadM', 'roadM.png');
    this.load.image('roadR', 'roadR.png');
    
    // –ë–æ–Ω—É—Å—ã –∏ –º–æ–Ω–µ—Ç—ã
    this.load.image('bonus1', 'bonus1.png');
    this.load.image('bonus2', 'bonus2.png');
    this.load.image('coin1', 'coin1.png');
    this.load.image('coin2', 'coin2.png');
    
    // –ü—Ä–µ–ø—è—Ç—Å—Ç–≤–∏—è (–º–∞—à–∏–Ω–∫–∏)
    this.load.image('ec', 'ec.png');
    this.load.image('ec1', 'ec1.png');
    this.load.image('ec2', 'ec2.png');
    
    // –§–æ–Ω –º–µ–Ω—é –∏ –ø–µ—Ä—Å–æ–Ω–∞–∂
    this.load.image('bgMenu', 'bgMenu.png');
    this.load.image('man1', 'man1.png');
    this.load.image('man2', 'man2.png');
    
    // –°—Ç–∞—Ä—ã–µ —Å–ø—Ä–∞–π—Ç—ã –¥–ª—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏
    this.load.image('bonus', 'bonus.png');
    this.load.image('obstacle', 'obstacle.png');
    
    // –ó–∞–≥—Ä—É–∂–∞–µ–º –≤—Å–µ –∑–≤—É–∫–∏
    this.load.audio('GM', 'GM.mp3');
    this.load.audio('smash', 'smash.mp3');
    this.load.audio('coin', 'coin.mp3');
    this.load.audio('benz', 'benz.mp3');
  }

  create() {
    this.laneCount = 3;
    this.speed = 200;
    this.score = 0;
    this.nextSpeedUp = 0;
    this.lastObstacleSpawnTime = 0;
    this.lastDiamondSpawnTime = 0;
    this.gameOverFlag = false;

    const gameWidth = this.sys.game.config.width;
    const gameHeight = this.sys.game.config.height;
    this.laneWidth = gameWidth / this.laneCount;

    // –°–æ–∑–¥–∞–µ–º –¥–æ—Ä–æ–≥—É –∏ —Ñ–æ–Ω–æ–≤—ã–µ —ç–ª–µ–º–µ–Ω—Ç—ã
    this.createRoad();
    this.createBackgroundElements();

    this.player = this.physics.add.sprite(gameWidth / 2, gameHeight * 0.8, 'car');
    this.player.setDisplaySize(gameWidth * 0.15, gameHeight * 0.08);
    this.player.setCollideWorldBounds(true);
    this.player.lane = 1;
    this.player.currentDirection = 'center'; // –û—Ç—Å–ª–µ–∂–∏–≤–∞–µ–º —Ç–µ–∫—É—â–µ–µ –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ

    this.obstacles = this.physics.add.group();
    this.bonuses = this.physics.add.group();
    this.extraBonuses = this.physics.add.group(); // –ù–æ–≤–∞—è –≥—Ä—É–ø–ø–∞ –¥–ª—è –º–æ–Ω–µ—Ç

    this.physics.add.overlap(this.player, this.obstacles, () => this.handleGameOver(), null, this);
    this.physics.add.overlap(this.player, this.bonuses, (player, bonus) => {
      bonus.destroy();
      this.score += 50;
      // –í–æ—Å–ø—Ä–æ–∏–∑–≤–æ–¥–∏–º –∑–≤—É–∫ —Å–±–æ—Ä–∞ –±–µ–Ω–∑–∏–Ω–∞
      SoundManager.playSound(this, 'benz', 1.0);
      this.createScoreEffect(bonus.x, bonus.y, '+50');
    }, null, this);

    // –û–±—Ä–∞–±–æ—Ç–∫–∞ —Å–±–æ—Ä–∞ –º–æ–Ω–µ—Ç–æ–∫ (—ç–∫—Å—Ç—Ä–∞ –±–æ–Ω—É—Å–æ–≤)
    this.physics.add.overlap(this.player, this.extraBonuses, (player, coin) => {
      coin.destroy();
      GameData.addDiamonds(1);
      // –í–æ—Å–ø—Ä–æ–∏–∑–≤–æ–¥–∏–º –∑–≤—É–∫ —Å–±–æ—Ä–∞ –º–æ–Ω–µ—Ç–∫–∏
      SoundManager.playSound(this, 'coin', 1.8);
      this.createScoreEffect(coin.x, coin.y, '+1');
      this.updateDiamondsDisplay();
    }, null, this);

    // –£–ª—É—á—à–µ–Ω–Ω—ã–π —Å—á–µ—Ç
    this.scoreText = this.add.text(20, 20, '–°–ß–ï–¢: 0', { 
      font: 'bold 24px Commissioner', 
      fill: '#FFEE00',
      stroke: '#222222',
      strokeThickness: 2
    });

    // –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –º–æ–Ω–µ—Ç –≤ –∏–≥—Ä–µ
    const gameCoinIcon = this.add.image(20, 75, 'coin1');
    gameCoinIcon.setDisplaySize(gameWidth * 0.12, gameHeight * 0.07);
    gameCoinIcon.setOrigin(0, 0.5);
    this.diamondsText = this.add.text(70, 60, `${GameData.getDiamonds()}`, {
      font: 'bold 20px Commissioner',
      fill: '#FFEE00',
      stroke: '#222222',
      strokeThickness: 1
    });

    this.input.keyboard.on('keydown-LEFT', () => this.changeLane(-1));
    this.input.keyboard.on('keydown-RIGHT', () => this.changeLane(1));
    
    // –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–≤–∞–π–ø–∞–º–∏
    this.input.on('pointerdown', (pointer) => {
      this.touchStartX = pointer.x;
      this.touchStartY = pointer.y;
      this.isTouching = true;
    });
    
    this.input.on('pointerup', (pointer) => {
      if (this.isTouching) {
        this.handleSwipe(pointer.x, pointer.y);
        this.isTouching = false;
      }
    });
    
    this.input.on('pointermove', (pointer) => {
      if (this.isTouching) {
        const deltaX = pointer.x - this.touchStartX;
        const deltaY = pointer.y - this.touchStartY;
        
        if (Math.abs(deltaX) > 50 && Math.abs(deltaX) > Math.abs(deltaY)) {
          if (deltaX > 0) {
            this.changeLane(1);
          } else {
            this.changeLane(-1);
          }
          this.isTouching = false;
        }
      }
    });

    // –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ –æ—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –≤—Å—é –ø—Ä–µ–¥—ã–¥—É—â—É—é –º—É–∑—ã–∫—É
    if (this.sound && this.sound.sounds) {
      this.sound.sounds.forEach(sound => {
        if (sound.isPlaying) {
          sound.stop();
        }
      });
    }
    
    // –ó–∞–ø—É—Å–∫–∞–µ–º –∏–≥—Ä–æ–≤—É—é –º—É–∑—ã–∫—É
    SoundManager.playMusic(this, 'GM', 0.175);
    
    // –ö–Ω–æ–ø–∫–∞ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∑–≤—É–∫–æ–º –≤ –ø—Ä–∞–≤–æ–º –≤–µ—Ä—Ö–Ω–µ–º —É–≥–ª—É
    this.createSoundButton(gameWidth * 0.9, gameHeight * 0.1);
  }

  createRoad() {
    const gameWidth = this.sys.game.config.width;
    const gameHeight = this.sys.game.config.height;
    
    // –†–∞–∑–º–µ—Ä—ã –¥–ª—è –Ω–æ–≤–æ–π –¥–æ—Ä–æ–≥–∏
    const sideWidth = gameWidth * 0.2; // –®–∏—Ä–∏–Ω–∞ –±–æ–∫–æ–≤—ã—Ö —á–∞—Å—Ç–µ–π
    const centerWidth = gameWidth * 0.6; // –®–∏—Ä–∏–Ω–∞ —Ü–µ–Ω—Ç—Ä–∞–ª—å–Ω–æ–π –¥–æ—Ä–æ–≥–∏
    
    // –°–æ–∑–¥–∞–µ–º –≥—Ä—É–ø–ø—ã –¥–ª—è –∞–Ω–∏–º–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö —ç–ª–µ–º–µ–Ω—Ç–æ–≤ –¥–æ—Ä–æ–≥–∏
    this.roadElements = this.add.group();
    
    // –°–æ–∑–¥–∞–µ–º –Ω–µ—Å–∫–æ–ª—å–∫–æ –∫–æ–ø–∏–π –¥–æ—Ä–æ–≥–∏ –¥–ª—è –±–µ—Å–∫–æ–Ω–µ—á–Ω–æ–π –ø—Ä–æ–∫—Ä—É—Ç–∫–∏
    for (let i = 0; i < 3; i++) {
      const yOffset = i * gameHeight - gameHeight;
      
      // –õ–µ–≤–∞—è —á–∞—Å—Ç—å (roadL)
      const roadLeft = this.add.image(sideWidth / 2, gameHeight / 2 + yOffset, 'roadL');
      roadLeft.setDisplaySize(sideWidth, gameHeight);
      this.roadElements.add(roadLeft);
      
      // –¶–µ–Ω—Ç—Ä–∞–ª—å–Ω–∞—è –¥–æ—Ä–æ–≥–∞ (roadM)
      const roadCenter = this.add.image(gameWidth / 2, gameHeight / 2 + yOffset, 'roadM');
      roadCenter.setDisplaySize(centerWidth, gameHeight);
      this.roadElements.add(roadCenter);
      
      // –ü—Ä–∞–≤–∞—è —á–∞—Å—Ç—å (roadR)
      const roadRight = this.add.image(gameWidth - sideWidth / 2, gameHeight / 2 + yOffset, 'roadR');
      roadRight.setDisplaySize(sideWidth, gameHeight);
      this.roadElements.add(roadRight);
    }
    
    // –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ –¥–ª—è –∏–≥—Ä–æ–≤–æ–π –ª–æ–≥–∏–∫–∏
    const roadStart = sideWidth;
    const roadWidth = centerWidth;
    const laneWidth = roadWidth / this.laneCount;
    
    this.laneWidth = laneWidth;
    this.roadStart = roadStart;
  }

  createBackgroundElements() {
    // –£–¥–∞–ª—è–µ–º —Å—Ç–∞—Ä—ã–µ —Ñ–æ–Ω–æ–≤—ã–µ —ç–ª–µ–º–µ–Ω—Ç—ã, —Ç–∞–∫ –∫–∞–∫ —Ç–µ–ø–µ—Ä—å –∏—Å–ø–æ–ª—å–∑—É–µ–º —Å–ø—Ä–∞–π—Ç—ã –¥–æ—Ä–æ–≥–∏
    // –ù–æ–≤—ã–µ —Å–ø—Ä–∞–π—Ç—ã roadL, roadM, roadR —É–∂–µ —Å–æ–¥–µ—Ä–∂–∞—Ç –≤—Å–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ —ç–ª–µ–º–µ–Ω—Ç—ã –æ–∫—Ä—É–∂–µ–Ω–∏—è
  }

  createScoreEffect(x, y, text) {
    if (text === '+1') {
      // –î–ª—è –º–æ–Ω–µ—Ç —Å–æ–∑–¥–∞–µ–º –∏–∫–æ–Ω–∫—É –≤–º–µ—Å—Ç–æ —Ç–µ–∫—Å—Ç–∞
      const coinEffect = this.add.image(x, y, 'coin1');
      coinEffect.setDisplaySize(this.sys.game.config.width * 0.06, this.sys.game.config.height * 0.04);
      
      this.tweens.add({
        targets: coinEffect,
        y: y - 50,
        alpha: 0,
        duration: 1000,
        ease: 'Power2',
        onComplete: () => coinEffect.destroy()
      });
    } else {
      const scoreText = this.add.text(x, y, text, {
        font: 'bold 20px Arial',
        fill: '#00ff00',
        stroke: '#000',
        strokeThickness: 2
      }).setOrigin(0.5);
      
      this.tweens.add({
        targets: scoreText,
        y: y - 50,
        alpha: 0,
        duration: 1000,
        ease: 'Power2',
        onComplete: () => scoreText.destroy()
      });
    }
  }

  updateDiamondsDisplay() {
    this.diamondsText.setText(`${GameData.getDiamonds()}`);
    this.diamondsText.setStyle({
      font: 'bold 20px Commissioner',
      fill: '#FFEE00',
      stroke: '#222222',
      strokeThickness: 1
    });
  }

  update(time, delta) {
    if (this.gameOverFlag) return;

    if (time > this.nextSpeedUp) {
      this.speed += 25;
      this.nextSpeedUp = time + 5000;
    }

    this.score += delta * 0.01;
    this.scoreText.setText('–°–ß–ï–¢: ' + Math.floor(this.score));

    // –°–ø–∞–≤–Ω –º–æ–Ω–µ—Ç–æ–∫ –∫–∞–∂–¥—ã–µ 25 —Å–µ–∫—É–Ω–¥
    if (time - this.lastDiamondSpawnTime > 25000) {
      const randomLane = Phaser.Math.Between(0, 2);
      this.spawnObject('extrabonus', randomLane);
      this.lastDiamondSpawnTime = time;
    }

    if (time - this.lastObstacleSpawnTime > 800) {
      const lanes = Phaser.Utils.Array.Shuffle([0, 1, 2]);
      let placedObstacles = 0;

      for (let i = 0; i < lanes.length; i++) {
        const lane = lanes[i];
        if (placedObstacles < 2 && Phaser.Math.Between(0, 1000) < 300) {
          this.spawnObject('obstacle', lane);
          placedObstacles++;
        } else if (Phaser.Math.Between(0, 1000) < 80) { // –£–≤–µ–ª–∏—á–µ–Ω–æ –¥–æ 80 –¥–ª—è –ª—É—á—à–µ–≥–æ –±–∞–ª–∞–Ω—Å–∞
          this.spawnObject('bonus', lane);
        }
      }
      this.lastObstacleSpawnTime = time;
    }

    this.obstacles.children.iterate(child => child.y += this.speed * delta / 1000);
    this.bonuses.children.iterate(child => child.y += this.speed * delta / 1000);
    this.extraBonuses.children.iterate(child => child.y += this.speed * delta / 1000);
    
    // –ê–Ω–∏–º–∞—Ü–∏—è –¥–æ—Ä–æ–≥–∏ - –¥–≤–∏–∂–µ–Ω–∏–µ —ç–ª–µ–º–µ–Ω—Ç–æ–≤ –≤–Ω–∏–∑ –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è —ç—Ñ—Ñ–µ–∫—Ç–∞ –µ–∑–¥—ã
    this.roadElements.children.iterate(roadElement => {
      roadElement.y += this.speed * delta / 1000 * 0.5; // –î–æ—Ä–æ–≥–∞ –¥–≤–∏–∂–µ—Ç—Å—è –º–µ–¥–ª–µ–Ω–Ω–µ–µ –æ–±—ä–µ–∫—Ç–æ–≤
      
      // –ï—Å–ª–∏ —ç–ª–µ–º–µ–Ω—Ç –¥–æ—Ä–æ–≥–∏ —É—à–µ–ª –∑–∞ –Ω–∏–∂–Ω–∏–π –∫—Ä–∞–π —ç–∫—Ä–∞–Ω–∞, –ø–µ—Ä–µ–º–µ—â–∞–µ–º –µ–≥–æ –Ω–∞–≤–µ—Ä—Ö
      if (roadElement.y > this.sys.game.config.height * 1.5) {
        roadElement.y -= this.sys.game.config.height * 3;
      }
    });
  }

  spawnObject(type, lane) {
    const x = this.roadStart + lane * this.laneWidth + this.laneWidth / 2;
    const y = -60;
    
    if (type === 'extrabonus') {
      // –°–æ–∑–¥–∞–µ–º –º–æ–Ω–µ—Ç–∫—É —Å –∞–Ω–∏–º–∞—Ü–∏–µ–π –∫–∞–¥—Ä–æ–≤
      const coin = this.extraBonuses.create(x, y, 'coin1');
      coin.setDisplaySize(this.sys.game.config.width * 0.1, this.sys.game.config.height * 0.08);
      coin.setImmovable(true);
      
      // –ê–Ω–∏–º–∞—Ü–∏—è –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è –º–µ–∂–¥—É coin1 –∏ coin2
      this.time.addEvent({
        delay: 500,
        callback: () => {
          if (coin && coin.active) {
            if (coin.texture.key === 'coin1') {
              coin.setTexture('coin2');
            } else {
              coin.setTexture('coin1');
            }
          }
        },
        repeat: -1
      });
      
      // –õ–µ–≥–∫–æ–µ –º–µ—Ä—Ü–∞–Ω–∏–µ
      this.tweens.add({
        targets: coin,
        alpha: 0.8,
        duration: 1000,
        yoyo: true,
        repeat: -1
      });
    } else if (type === 'bonus') {
      // –°–æ–∑–¥–∞–µ–º –±–æ–Ω—É—Å —Å –∞–Ω–∏–º–∞—Ü–∏–µ–π –∫–∞–¥—Ä–æ–≤
      const sprite = this.bonuses.create(x, y, 'bonus1');
      sprite.setDisplaySize(this.sys.game.config.width * 0.12, this.sys.game.config.height * 0.08);
      sprite.setImmovable(true);
      
      // –ê–Ω–∏–º–∞—Ü–∏—è –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è –º–µ–∂–¥—É bonus1 –∏ bonus2
      this.time.addEvent({
        delay: 400,
        callback: () => {
          if (sprite && sprite.active) {
            if (sprite.texture.key === 'bonus1') {
              sprite.setTexture('bonus2');
            } else {
              sprite.setTexture('bonus1');
            }
          }
        },
        repeat: -1
      });
    } else if (type === 'obstacle') {
      // –ò—Å–ø–æ–ª—å–∑—É–µ–º –Ω–æ–≤—ã–µ —Å–ø—Ä–∞–π—Ç—ã –ø—Ä–µ–ø—è—Ç—Å—Ç–≤–∏–π (–º–∞—à–∏–Ω–∫–∏)
      const obstacleTextures = ['ec', 'ec1', 'ec2'];
      const obstacleTexture = obstacleTextures[Phaser.Math.Between(0, 2)];
      const sprite = this.obstacles.create(x, y, obstacleTexture);
      sprite.setDisplaySize(this.sys.game.config.width * 0.14, this.sys.game.config.height * 0.09);
      sprite.setImmovable(true);
    }
  }

  changeLane(dir) {
    if (this.gameOverFlag) return;
    
    const newLane = Phaser.Math.Clamp(this.player.lane + dir, 0, this.laneCount - 1);
    if (newLane !== this.player.lane) {
      this.player.lane = newLane;
      
      // –ú–µ–Ω—è–µ–º —Å–ø—Ä–∞–π—Ç –∏ –∞–Ω–∏–º–∏—Ä—É–µ–º —Ç–µ–Ω—å –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø–æ–≤–æ—Ä–æ—Ç–∞
      if (dir > 0) {
        this.player.setTexture('carR');
        this.player.currentDirection = 'right';
        this.tweens.add({
            targets: this.playerShadow,
            scaleX: 1.1,
            angle: 15,
            duration: 150,
            yoyo: true,
            ease: 'Sine.easeInOut'
        });
      } else {
        this.player.setTexture('carL');
        this.player.currentDirection = 'left';
        this.tweens.add({
            targets: this.playerShadow,
            scaleX: 1.1,
            angle: -15,
            duration: 150,
            yoyo: true,
            ease: 'Sine.easeInOut'
        });
      }
      
      // –í–æ–∑–≤—Ä–∞—â–∞–µ–º –æ–±—ã—á–Ω—ã–π —Å–ø—Ä–∞–π—Ç —á–µ—Ä–µ–∑ –∫–æ—Ä–æ—Ç–∫–æ–µ –≤—Ä–µ–º—è
      this.time.delayedCall(300, () => {
        if (this.player && !this.gameOverFlag) {
          this.player.setTexture('car');
          this.player.currentDirection = 'center';
        }
      });
      
      this.player.x = this.roadStart + this.player.lane * this.laneWidth + this.laneWidth / 2;
    }
  }

  handleGameOver() {
    if (this.gameOverFlag) return;
    this.gameOverFlag = true;

    // –í–æ—Å–ø—Ä–æ–∏–∑–≤–æ–¥–∏–º –∑–≤—É–∫ —Å—Ç–æ–ª–∫–Ω–æ–≤–µ–Ω–∏—è
    SoundManager.playSound(this, 'smash', 0.7);
    
    // –û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∏–≥—Ä–æ–≤—É—é –º—É–∑—ã–∫—É
    SoundManager.stopMusic(this);

    // –°–æ—Ö—Ä–∞–Ω—è–µ–º —Å—á–µ—Ç
    GameData.saveScore(this.score);

    this.physics.pause();
    this.player.setTint(0xff0000);

    // –≠–∫—Ä–∞–Ω –æ–∫–æ–Ω—á–∞–Ω–∏—è –∏–≥—Ä—ã
    const gameWidth = this.sys.game.config.width;
    const gameHeight = this.sys.game.config.height;
    
    // –ó–∞—Ç–µ–º–Ω–µ–Ω–∏–µ —Ñ–æ–Ω–∞
    const overlay = this.add.rectangle(gameWidth / 2, gameHeight / 2, gameWidth, gameHeight, 0x000000, 0.8);
    
    // –û—Å–Ω–æ–≤–Ω–æ–µ –æ–∫–Ω–æ –¥–∏–∞–ª–æ–≥–∞
    const dialogBg = this.add.graphics();
    dialogBg.fillStyle(0x222222, 0.95);
    dialogBg.fillRoundedRect(gameWidth / 2 - 200, gameHeight / 2 - 150, 400, 300, 15);
    dialogBg.lineStyle(3, 0xFFEE00);
    dialogBg.strokeRoundedRect(gameWidth / 2 - 200, gameHeight / 2 - 150, 400, 300, 15);
    
    // –ó–∞–≥–æ–ª–æ–≤–æ–∫
    this.add.text(gameWidth / 2, gameHeight / 2 - 80, '–ò–ì–†–ê –û–ö–û–ù–ß–ï–ù–ê', { 
      font: 'bold 28px Commissioner', 
      fill: '#FFEE00',
      stroke: '#222222',
      strokeThickness: 2
    }).setOrigin(0.5);
    
    // –°—á–µ—Ç —Å –∞–Ω–∏–º–∞—Ü–∏–µ–π –ø—Ä–æ–∫—Ä—É—Ç–∫–∏
    this.finalScoreText = this.add.text(gameWidth / 2, gameHeight / 2 - 40, '–ò—Ç–æ–≥–æ–≤—ã–π —Å—á–µ—Ç: 0', { 
      font: 'bold 20px Commissioner', 
      fill: '#C8C8C8',
      stroke: '#222222',
      strokeThickness: 1
    }).setOrigin(0.5);
    
    // –ê–Ω–∏–º–∞—Ü–∏—è –ø—Ä–æ–∫—Ä—É—Ç–∫–∏ —Å—á–µ—Ç–∞ –æ—Ç 0 –¥–æ —Ñ–∏–Ω–∞–ª—å–Ω–æ–≥–æ –∑–Ω–∞—á–µ–Ω–∏—è
    const finalScore = Math.floor(this.score);
    const scoreCounter = { value: 0 };
    
    this.tweens.add({
      targets: scoreCounter,
      value: finalScore,
      duration: 2000, // 2 —Å–µ–∫—É–Ω–¥—ã –∞–Ω–∏–º–∞—Ü–∏–∏
      ease: 'Power2',
      onUpdate: () => {
        this.finalScoreText.setText('–ò—Ç–æ–≥–æ–≤—ã–π —Å—á–µ—Ç: ' + Math.floor(scoreCounter.value));
        // –î–æ–±–∞–≤–ª—è–µ–º —ç—Ñ—Ñ–µ–∫—Ç –º–µ—Ä—Ü–∞–Ω–∏—è –≤–æ –≤—Ä–µ–º—è –ø–æ–¥—Å—á–µ—Ç–∞
        if (scoreCounter.value < finalScore) {
          this.finalScoreText.setFill('#FFEE00');
        } else {
          this.finalScoreText.setFill('#C8C8C8');
        }
      },
      onComplete: () => {
        // –§–∏–Ω–∞–ª—å–Ω—ã–π —ç—Ñ—Ñ–µ–∫—Ç –ø—Ä–∏ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–∏ –ø–æ–¥—Å—á–µ—Ç–∞
        this.tweens.add({
          targets: this.finalScoreText,
          scaleX: 1.2,
          scaleY: 1.2,
          duration: 200,
          yoyo: true,
          ease: 'Back.easeOut'
        });
      }
    });
    
    // –ö–Ω–æ–ø–∫–∞ "–ù–∞—á–∞—Ç—å –∑–∞–Ω–æ–≤–æ"
    this.createGameOverButton(gameWidth / 2, gameHeight / 2 + 10, '–ù–ê–ß–ê–¢–¨ –ó–ê–ù–û–í–û', () => {
      this.scene.restart();
    });

    // –ö–Ω–æ–ø–∫–∞ "–ú–µ–Ω—é"
    this.createGameOverButton(gameWidth / 2, gameHeight / 2 + 70, '–ú–ï–ù–Æ', () => {
      this.scene.start('MenuScene');
    });
  }

  createGameOverButton(x, y, text, callback) {
    // –°–æ–∑–¥–∞–µ–º —Ñ–æ–Ω –∫–Ω–æ–ø–∫–∏ —Å–æ —Å–∫—Ä—É–≥–ª–µ–Ω–∏—è–º–∏ –≤ –∫–æ—Ä–ø–æ—Ä–∞—Ç–∏–≤–Ω–æ–º —Å—Ç–∏–ª–µ
    const buttonBg = this.add.graphics();
    buttonBg.fillStyle(0xFFEE00);
    buttonBg.fillRoundedRect(x - 120, y - 25, 240, 50, 15);
    buttonBg.lineStyle(3, 0x222222);
    buttonBg.strokeRoundedRect(x - 120, y - 25, 240, 50, 15);

    // –ù–µ–≤–∏–¥–∏–º–∞—è –æ–±–ª–∞—Å—Ç—å –¥–ª—è –∫–ª–∏–∫–∞ (–±–æ–ª—å—à–µ –æ—Å–Ω–æ–≤–Ω–æ–π –∫–Ω–æ–ø–∫–∏)
    const clickArea = this.add.rectangle(x, y, 260, 70, 0x000000, 0);
    clickArea.setInteractive();

    const button = this.add.text(x, y, text, {
      font: 'bold 20px Commissioner',
      fill: '#222222'
    }).setOrigin(0.5);

    clickArea
      .on('pointerdown', callback)
      .on('pointerover', () => {
        buttonBg.clear();
        buttonBg.fillStyle(0x222222);
        buttonBg.fillRoundedRect(x - 120, y - 25, 240, 50, 15);
        buttonBg.lineStyle(3, 0xFFEE00);
        buttonBg.strokeRoundedRect(x - 120, y - 25, 240, 50, 15);
        button.setFill('#FFEE00');
        button.setScale(1.05);
      })
      .on('pointerout', () => {
        buttonBg.clear();
        buttonBg.fillStyle(0xFFEE00);
        buttonBg.fillRoundedRect(x - 120, y - 25, 240, 50, 15);
        buttonBg.lineStyle(3, 0x222222);
        buttonBg.strokeRoundedRect(x - 120, y - 25, 240, 50, 15);
        button.setFill('#222222');
        button.setScale(1);
      });
    return button;
  }

  handleSwipe(endX, endY) {
    const deltaX = endX - this.touchStartX;
    const deltaY = endY - this.touchStartY;
    
    const minSwipeDistance = 30;
    
    if (Math.abs(deltaX) > minSwipeDistance) {
      if (Math.abs(deltaX) > Math.abs(deltaY)) {
        if (deltaX > 0) {
          this.changeLane(1);
        } else {
          this.changeLane(-1);
        }
      }
    } else {
      const screenWidth = this.sys.game.config.width;
      if (endX < screenWidth / 2) {
        this.changeLane(-1);
      } else {
        this.changeLane(1);
      }
    }
  }

  createSoundButton(x, y) {
    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ –∑–≤—É–∫–∞
    SoundManager.getMuteState();
    
    // –°–æ–∑–¥–∞–µ–º –∫–Ω–æ–ø–∫—É –∑–≤—É–∫–∞
    const soundButton = this.add.text(x, y, SoundManager.isMuted ? 'üîá' : 'üîä', {
      font: 'bold 32px Arial',
      fill: '#FFEE00',
      stroke: '#222222',
      strokeThickness: 2
    }).setOrigin(0.5).setInteractive();
    
    soundButton.on('pointerdown', () => {
      // –ü—Ä–æ—Å—Ç–æ–µ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –∑–≤—É–∫–∞ –±–µ–∑ —Å–ª–æ–∂–Ω—ã—Ö overlay
      SoundManager.toggleMute();
      soundButton.setText(SoundManager.isMuted ? 'üîá' : 'üîä');
      SoundManager.updateMuteState(this);
      
      // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ
      this.showSoundNotification(x, y - 60);
    });
    
    soundButton.on('pointerover', () => {
      soundButton.setScale(1.2);
    });
    
    soundButton.on('pointerout', () => {
      soundButton.setScale(1);
    });
  }
  
  showSoundNotification(x, y) {
    // –°–æ–∑–¥–∞–µ–º –≤—Ä–µ–º–µ–Ω–Ω–æ–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ
    const notification = this.add.text(x, y, SoundManager.isMuted ? '–ó–í–£–ö –í–´–ö–õ–Æ–ß–ï–ù' : '–ó–í–£–ö –í–ö–õ–Æ–ß–Å–ù', {
      font: 'bold 16px Commissioner',
      fill: SoundManager.isMuted ? '#FF4444' : '#44FF44',
      stroke: '#222222',
      strokeThickness: 2
    }).setOrigin(0.5);
    
    // –ê–Ω–∏–º–∞—Ü–∏—è –ø–æ—è–≤–ª–µ–Ω–∏—è –∏ –∏—Å—á–µ–∑–Ω–æ–≤–µ–Ω–∏—è
    this.tweens.add({
      targets: notification,
      alpha: 0,
      y: y - 30,
      duration: 2000,
      ease: 'Power2',
      onComplete: () => {
        notification.destroy();
      }
    });
  }
}

const config = {
  type: Phaser.AUTO,
  width: window.innerWidth,
  height: window.innerHeight,
  physics: { default: 'arcade' },
  scene: [MenuScene, ShopScene, PromotionsScene, LeaderboardScene, MainScene]
};

const game = new Phaser.Game(config);

window.addEventListener('resize', () => {
  game.scale.resize(window.innerWidth, window.innerHeight);
});
</script>
</body>
</html>
